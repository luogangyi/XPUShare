# ç¯å¢ƒè¯´æ˜
Nvidia GPU T4 * 2 (16G æ˜¾å­˜ * 2)

# æµ‹è¯•0ï¼ŒåŸºå‡†æµ‹è¯•
ä¿®æ”¹ä¸ºåŸç”Ÿnvidiaçš„device-pluginï¼Œå¯¹pytorch-add.pyã€pytorch-add-small.pyã€pytorch-add-idle-small.pyè¿›è¡Œæµ‹è¯•ã€‚

./remote-base-test.sh

æµ‹è¯•ç»“æœï¼š
```
pytorch-add-baseline           | PASS     | 163s
pytorch-small-baseline         | PASS     | 392s
pytorch-idle-small-baseline    | PASS     | 445s
```

# æµ‹è¯•1ï¼Œå•ä¸ªä»»åŠ¡å æ»¡æ˜¾å­˜ï¼Œç‹¬å GPU

è¯•ç”¨tests/pytorch-add.py è´Ÿè½½æ»¡è´Ÿè·æµ‹è¯•GPUï¼Œæ¯ä¸ªä»»åŠ¡GPUæ˜¾å­˜å ç”¨çº¦12GBï¼Œç®—åŠ›å ç”¨100%

remote-test.sh --skip-setup 2

æµ‹è¯•ç»“æœ

```
Scheduler Log Analysis (GPU Distribution):
Analyzing scheduler pod: nvshare-scheduler-g8lhv
Pod Name                       | Client ID          | GPU UUID
--------------------------------------------------------------------------------------------
nvshare-cross-gpu-1            | febebf756a61f686   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e
nvshare-cross-gpu-2            | f2a9071d95ed7ff5   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1

==========================================================================================
nvshare-cross-gpu-1            | PASS     | 164s         | 25.83 it/s   | 1024
nvshare-cross-gpu-2            | PASS     | 164s         | 25.80 it/s   | 1024
==========================================================================================

ğŸ“Š ç»Ÿè®¡åˆ†æ:
  Total: 2, Pass: 2, Fail: 0
  Duration: Min=164s, Max=164s, Avg=164.0s
  Speed   : Min=25.80, Max=25.83, Avg=25.81 (it/s)


==========================================
âœ… æµ‹è¯•é€šè¿‡ï¼šè·¨ GPU è´Ÿè½½åˆ†å¸ƒæˆåŠŸ
==========================================
```

# æµ‹è¯•2ï¼Œå¤šä¸ªä»»åŠ¡ä¸²è¡Œï¼Œå…±äº«ç‹¬å GPU

## é…ç½®ä¸ºä¸²è¡Œæ¨¡å¼

è¯•ç”¨tests/pytorch-add.py è´Ÿè½½æ»¡è´Ÿè·æµ‹è¯•GPUï¼Œæ¯ä¸ªä»»åŠ¡GPUæ˜¾å­˜å ç”¨çº¦12GBï¼Œç®—åŠ›å ç”¨100%

remote-test.sh --serial--skip-setup 4 

æµ‹è¯•ç»“æœ

```
Scheduler Log Analysis (GPU Distribution):
Analyzing scheduler pod: nvshare-scheduler-g79d6
Pod Name                       | Client ID          | GPU UUID
--------------------------------------------------------------------------------------------
nvshare-cross-gpu-1            | c6c3068df341e374   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e
nvshare-cross-gpu-2            | edbbd0a17e2b8350   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1
nvshare-cross-gpu-3            | 622900c037f9ea29   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1
nvshare-cross-gpu-4            | d3ce8c7d1b51ded2   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e

==========================================================================================
nvshare-cross-gpu-1            | PASS     | 309s         | 22.24 it/s   | 1024
nvshare-cross-gpu-2            | PASS     | 310s         | 22.21 it/s   | 1024
nvshare-cross-gpu-3            | PASS     | 346s         | 23.62 it/s   | 1024
nvshare-cross-gpu-4            | PASS     | 342s         | 23.65 it/s   | 1024
==========================================================================================

ğŸ“Š ç»Ÿè®¡åˆ†æ:
  Total: 4, Pass: 4, Fail: 0
  Duration: Min=309s, Max=346s, Avg=326.8s
  Speed   : Min=22.21, Max=23.65, Avg=22.93 (it/s)


==========================================
âœ… æµ‹è¯•é€šè¿‡ï¼šè·¨ GPU è´Ÿè½½åˆ†å¸ƒæˆåŠŸ
==========================================
```

## é…ç½®ä¸ºautoæ¨¡å¼

```
Analyzing scheduler pod: nvshare-scheduler-vcmhq
Pod Name                       | Client ID          | GPU UUID
--------------------------------------------------------------------------------------------
nvshare-cross-gpu-1            | 590f7404f4a2ee15   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e
nvshare-cross-gpu-2            | 907c730df22d942d   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1
nvshare-cross-gpu-3            | b03d1525817c98be   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1
nvshare-cross-gpu-4            | 7acd81ec86234e36   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e

==========================================================================================
nvshare-cross-gpu-1            | PASS     | 282s         | 24.47 it/s   | 1024
nvshare-cross-gpu-2            | PASS     | 347s         | 21.18 it/s   | 1024
nvshare-cross-gpu-3            | PASS     | 345s         | 6.48 it/s    | 1024
nvshare-cross-gpu-4            | PASS     | 341s         | 25.38 it/s   | 1024
==========================================================================================

ğŸ“Š ç»Ÿè®¡åˆ†æ:
  Total: 4, Pass: 4, Fail: 0
  Duration: Min=282s, Max=347s, Avg=328.8s
  Speed   : Min=6.48, Max=25.38, Avg=19.38 (it/s)


==========================================
âœ… æµ‹è¯•é€šè¿‡ï¼šè·¨ GPU è´Ÿè½½åˆ†å¸ƒæˆåŠŸ
==========================================
```

# æµ‹è¯•3ï¼Œå•ä¸ªä»»åŠ¡å 1/4æ˜¾å­˜ï¼Œç‹¬å GPU

è¯•ç”¨tests/pytorch-add-small.py è´Ÿè½½æ»¡è´Ÿè·æµ‹è¯•GPUï¼Œæ¯ä¸ªä»»åŠ¡GPUæ˜¾å­˜å ç”¨çº¦4GBï¼Œç®—åŠ›å ç”¨100%

./remote-test-small.sh --skip-setup 2

æµ‹è¯•ç»“æœ

```
Scheduler Log Analysis (GPU Distribution):
Analyzing scheduler pod: nvshare-scheduler-8hww8
Pod Name                       | Client ID          | GPU UUID
--------------------------------------------------------------------------------------------
nvshare-small-1                | 7168850a95d8871a   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e
nvshare-small-2                | ecd31afb7530d21e   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1

==========================================================================================
nvshare-small-1                | PASS     | 392s         | 103.61 it/s  | 2048
nvshare-small-2                | PASS     | 393s         | 103.40 it/s  | 2048
==========================================================================================

ğŸ“Š ç»Ÿè®¡åˆ†æ:
  Total: 2, Pass: 2, Fail: 0
  Duration: Min=392s, Max=393s, Avg=392.5s
  Speed   : Min=103.40, Max=103.61, Avg=103.50 (it/s)


==========================================
âœ… æµ‹è¯•é€šè¿‡ï¼šSmall Workload å…¨éƒ¨æˆåŠŸ
==========================================
```

# æµ‹è¯•4ï¼Œå•ä¸ªä»»åŠ¡å 1/4æ˜¾å­˜ï¼Œå…±äº«ä½¿ç”¨GPU

è¯•ç”¨tests/pytorch-add-small.py è´Ÿè½½æ»¡è´Ÿè·æµ‹è¯•GPUï¼Œæ¯ä¸ªä»»åŠ¡GPUæ˜¾å­˜å ç”¨çº¦4GBï¼Œç®—åŠ›å ç”¨100%ï¼ˆç”±äºå…±äº«GPUï¼Œå®é™…å ç”¨çº¦1/2)

./remote-test-small.sh --skip-setup 

æµ‹è¯•ç»“æœ

```
Scheduler Log Analysis (GPU Distribution):
Analyzing scheduler pod: nvshare-scheduler-b66f8
Pod Name                       | Client ID          | GPU UUID
--------------------------------------------------------------------------------------------
nvshare-small-1                | a12c4b64b99e09dc   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1
nvshare-small-3                | 3ddc0cbb29e864ce   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e
nvshare-small-2                | 8a1187551fc907a3   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e
nvshare-small-4                | dc896c93bd23d55f   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1

==========================================================================================
nvshare-small-1                | PASS     | 866s         | 46.43 it/s   | 1024
nvshare-small-2                | PASS     | 869s         | 47.38 it/s   | 1024
nvshare-small-3                | PASS     | 868s         | 46.42 it/s   | 1024
nvshare-small-4                | PASS     | 867s         | 77.21 it/s   | 1024
==========================================================================================

ğŸ“Š ç»Ÿè®¡åˆ†æ:
  Total: 4, Pass: 4, Fail: 0
  Duration: Min=866s, Max=869s, Avg=867.5s
  Speed   : Min=46.42, Max=77.21, Avg=54.36 (it/s)


==========================================
âœ… æµ‹è¯•é€šè¿‡ï¼šSmall Workload å…¨éƒ¨æˆåŠŸ
==========================================
```

# æµ‹è¯•5ï¼Œæ¯ä¸ªä»»åŠ¡å 1/4 GPUï¼Œç‹¬å GPU
è¯•ç”¨tests/pytorch-add-idle-small.py é—´æ­‡æ€§æµ‹è¯•GPUï¼Œæ¯ä¸ªä»»åŠ¡GPUæ˜¾å­˜å ç”¨çº¦4GBï¼Œç®—åŠ›å ç”¨çº¦50%%

remote-test-idle-small.sh --skip-setup 1

æµ‹è¯•ç»“æœ
```
Scheduler Log Analysis (GPU Distribution):
Analyzing scheduler pod: nvshare-scheduler-vcmhq
Pod Name                       | Client ID          | GPU UUID
--------------------------------------------------------------------------------------------
nvshare-idle-small-1           | 6b8926a17f393395   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1

==========================================================================================
nvshare-idle-small-1           | PASS     | 444s         | 9.12 it/s    | 2048
==========================================================================================

ğŸ“Š ç»Ÿè®¡åˆ†æ:
  Total: 1, Pass: 1, Fail: 0
  Duration: Min=444s, Max=444s, Avg=444.0s
  Speed   : Min=9.12, Max=9.12, Avg=9.12 (it/s)


==========================================
âœ… æµ‹è¯•é€šè¿‡ï¼šIdle Small Workload
==========================================
```

# æµ‹è¯•6ï¼Œæ¯ä¸ªä»»åŠ¡å 1/4 GPUï¼Œå…±äº«GPU
è¯•ç”¨tests/pytorch-add-idle-small.py é—´æ­‡æ€§æµ‹è¯•GPUï¼Œæ¯ä¸ªä»»åŠ¡GPUæ˜¾å­˜å ç”¨çº¦4GBï¼Œç®—åŠ›å ç”¨çº¦10%%ï¼Œå…±äº«GPUï¼Œç”±äºæœ¬èº«ä»»åŠ¡å°±ä¸éœ€è¦è·‘æ»¡GPUç®—åŠ›ï¼Œç†è®ºä¸Šå¹¶è¡Œä¸ä¼šå½±å“ä»»åŠ¡å®Œæˆæ—¶é—´ã€‚

remote-test-idle-small.sh --skip-setup 6

æµ‹è¯•ç»“æœ
```
Scheduler Log Analysis (GPU Distribution):
Analyzing scheduler pod: nvshare-scheduler-8ss4f
Pod Name                       | Client ID          | GPU UUID
--------------------------------------------------------------------------------------------
nvshare-idle-small-3           | d5bd144e36db3ac1   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e
nvshare-idle-small-2           | 5303e558781a9411   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1
nvshare-idle-small-4           | 4c35e94d799441ab   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1
nvshare-idle-small-5           | 78d1a1c85ea5f193   | GPU-dc895bd6-43d7-a984-b1ee-870332194bd1
nvshare-idle-small-1           | a5fdcec1c148ce27   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e
nvshare-idle-small-6           | 478c496370dd9c3f   | GPU-1f4246ce-cc92-8c8d-9f31-83660be04a1e

==========================================================================================
nvshare-idle-small-1           | PASS     | 481s         | 8.32 it/s    | 2048
nvshare-idle-small-2           | PASS     | 483s         | 8.42 it/s    | 2048
nvshare-idle-small-3           | PASS     | 481s         | 8.51 it/s    | 2048
nvshare-idle-small-4           | PASS     | 482s         | 9.05 it/s    | 2048
nvshare-idle-small-5           | PASS     | 483s         | 8.19 it/s    | 2048
nvshare-idle-small-6           | PASS     | 481s         | 9.07 it/s    | 2048
==========================================================================================

ğŸ“Š ç»Ÿè®¡åˆ†æ:
  Total: 6, Pass: 6, Fail: 0
  Duration: Min=481s, Max=483s, Avg=481.8s
  Speed   : Min=8.19, Max=9.07, Avg=8.59 (it/s)


==========================================
âœ… æµ‹è¯•é€šè¿‡ï¼šIdle Small Workload
==========================================
```

# 7. æµ‹è¯•æ€»ç»“ä¸åˆ†æ

æœ¬è½®æµ‹è¯•è¦†ç›–äº†åŸºå‡†æ€§èƒ½ã€ç‹¬å æ¨¡å¼ã€ä¸²è¡Œå…±äº«ã€é«˜è´Ÿè½½å¹¶å‘åŠä½è´Ÿè½½å¹¶å‘ç­‰å¤šç§åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯å¯¹ NVShare GPU å…±äº«æ–¹æ¡ˆçš„æ ¸å¿ƒæŒ‡æ ‡åˆ†æï¼š

## 1. è™šæ‹ŸåŒ–å¼€é”€ (Virtualization Overhead)
**ç»“è®ºï¼šæä½ (< 1%)**
é€šè¿‡å¯¹æ¯” **Test 0 (åŸºå‡†)** ä¸ **Test 1/3/5 (NVShareç‹¬å çŠ¶æ€)** çš„æ•°æ®å¯ä»¥çœ‹åˆ°ï¼š
*   Standard (Compute Heavy): 163s (Base) vs 164s (NVShare)
*   Small (Memory Bound): 392s (Base) vs 392.5s (NVShare)
*   Idle (Latency Sensitive): 445s (Base) vs 444s (NVShare)
NVShare çš„æ‹¦æˆªä¸è°ƒåº¦æœºåˆ¶åœ¨å•ä»»åŠ¡åœºæ™¯ä¸‹å‡ ä¹ä¸äº§ç”Ÿé¢å¤–çš„æ—¶é—´å¼€é”€ï¼Œè¯æ˜äº†å…¶è½»é‡çº§è®¾è®¡çš„ä¼˜åŠ¿ã€‚

## 2. è°ƒåº¦ç­–ç•¥æ­£ç¡®æ€§ä¸å†…å­˜å®‰å…¨æ€§ (Correctness & Safety)
**ç»“è®ºï¼šç¬¦åˆé¢„æœŸï¼Œæœ‰æ•ˆé˜²æ­¢ OOM**
*   åœ¨ **Test 2 (Standard)** ä¸­ï¼Œå•ä»»åŠ¡æ˜¾å­˜å ç”¨ 12GBï¼Œæ˜¾å­˜ (16GB) æ— æ³•åŒæ—¶å®¹çº³ä¸¤ä¸ªä»»åŠ¡ã€‚
    *   **Serial æ¨¡å¼**: å¹³å‡è€—æ—¶ ~327s (çº¦ä¸ºåŸºå‡† 163s çš„ 2 å€)ï¼Œç¬¦åˆä¸²è¡Œæ‰§è¡Œçš„ç†è®ºå€¼ã€‚
    *   **Auto æ¨¡å¼**: å¹³å‡è€—æ—¶ ~329sï¼Œä¸ Serial æ¨¡å¼æå…¶æ¥è¿‘ã€‚
    *   **åˆ†æ**: è¿™è¡¨æ˜ NVShare å‡†ç¡®è¯†åˆ«äº†æ˜¾å­˜å‹åŠ›ï¼Œè‡ªåŠ¨è§¦å‘äº†ä¸²è¡Œè°ƒåº¦æˆ–é«˜æ•ˆçš„ Time-Slicing æœºåˆ¶ï¼Œé¿å…äº†å¹¶å‘è¿è¡Œå¯¼è‡´çš„ OOM å´©æºƒæˆ–ä¸¥é‡çš„ Swap æŠ–åŠ¨ã€‚

## 3. å¹¶å‘æ•ˆç‡ä¸ç®—åŠ›å…±äº« (Concurrency Efficiency)
**ç»“è®ºï¼šè®¡ç®—å¯†é›†å‹çº¿æ€§æ‰©å±•ï¼Œç©ºé—²/IOå¯†é›†å‹æ˜¾è‘—æå‡å¯†åº¦**
*   **Test 4 (Small, é«˜ç®—åŠ›å¹¶å‘)**:
    *   åœºæ™¯: 2 ä»»åŠ¡/GPUï¼Œæ˜¾å­˜å……è¶³ï¼Œä½†ç®—åŠ›éœ€æ±‚å‡ä¸º 100%ã€‚
    *   ç»“æœ: è€—æ—¶ ~867sï¼Œçº¦æ˜¯åŸºå‡† (392s) çš„ 2.2 å€ã€‚
    *   **åˆ†æ**: æ­¤æ—¶ç“¶é¢ˆåœ¨äº GPU CUDA Core ç®—åŠ›ã€‚ä¸¤ä»»åŠ¡ç«äº‰ç®—åŠ›å¯¼è‡´æ—¶é—´ç¿»å€ï¼Œé¢å¤– ~10% çš„å¼€é”€æ¥è‡ªä¸Šä¸‹æ–‡åˆ‡æ¢ (Context Switch)ã€‚è¿™æ˜¯æ—¶åˆ†å¤ç”¨ (Time-Slicing) çš„æ­£å¸¸è¡¨ç°ã€‚
*   **Test 6 (Idle, ä½ç®—åŠ›å¹¶å‘)**:
    *   åœºæ™¯: 3 ä»»åŠ¡/GPUï¼Œæ˜¾å­˜å……è¶³ï¼Œç®—åŠ›éœ€æ±‚ä½ (~10%)ã€‚
    *   ç»“æœ: è€—æ—¶ ~482sï¼Œä»…æ¯”åŸºå‡† (445s) å¢åŠ çº¦ 8%ã€‚
    *   **åˆ†æ**: è¿™æ˜¯ GPU å…±äº«çš„æœ€ä½³åœºæ™¯ã€‚NVShare æˆåŠŸå®ç°äº† 3 å€çš„ä»»åŠ¡éƒ¨ç½²å¯†åº¦ï¼ŒåŒæ—¶ä»…ç‰ºç‰²äº† <10% çš„è¿è¡Œæ—¶é—´ã€‚è¿™è¯æ˜äº†åœ¨æ¨ç†æœåŠ¡æˆ–å¼€å‘ç¯å¢ƒä¸­ï¼ŒNVShare èƒ½æ˜¾è‘—æå‡ GPU åˆ©ç”¨ç‡ã€‚

## 4. æ€»ä½“è¯„ä»·
NVShare åœ¨ä¿è¯**é›¶ä¾µå…¥æ€§**ï¼ˆæ— éœ€ä¿®æ”¹ä»£ç ï¼‰å’Œ**ä½å¼€é”€**çš„å‰æä¸‹ï¼Œå±•ç¤ºäº†ä¼˜ç§€çš„è°ƒåº¦èƒ½åŠ›ï¼š
1.  **å®‰å…¨æ€§**: å†…å­˜ä¸è¶³æ—¶è‡ªåŠ¨ä¸²è¡Œï¼Œä¿è¯ä»»åŠ¡æˆåŠŸç‡ã€‚
2.  **é«˜åˆ©ç”¨ç‡**: åœ¨æ˜¾å­˜å’Œç®—åŠ›å…è®¸æ—¶ï¼ˆå¦‚ Test 6ï¼‰ï¼Œèƒ½å¤§å¹…æå‡éƒ¨ç½²å¯†åº¦è€Œå‡ ä¹ä¸å½±å“æ€§èƒ½ã€‚
3.  **å…¬å¹³æ€§**: ä»è·¨ GPU æµ‹è¯•æ—¥å¿—çœ‹ï¼Œä»»åŠ¡è¢«å‡åŒ€åˆ†é…åˆ°äº†ä¸åŒ GPU ä¸Šï¼Œæœªå‡ºç°è´Ÿè½½å€¾æ–œã€‚
