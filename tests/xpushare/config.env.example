# Copy this file to tests/xpushare/config.env and fill values before running.

# Cluster kubeconfigs
export XPUSHARE_KUBECONFIG_C1="$HOME/Code/configs/kubeconfig-fuyao-gpu"
export XPUSHARE_KUBECONFIG_C2="$HOME/Code/configs/kubeconfig-kcs-gpu"

# Optional: override namespaces
export XPUSHARE_DEFAULT_NAMESPACE="default"
export XPUSHARE_SYSTEM_NAMESPACE="nvshare-system"

# Optional: workload images
export XP_IMAGE_PYTORCH_ADD="registry.cn-hangzhou.aliyuncs.com/lgytest1/nvshare:pytorch-add-5fed3e5b"
export XP_IMAGE_PYTORCH_ADD_SMALL="registry.cn-hangzhou.aliyuncs.com/lgytest1/nvshare:pytorch-add-small-5fed3e5b"
export XP_IMAGE_PYTORCH_ADD_IDLE_SMALL="registry.cn-hangzhou.aliyuncs.com/lgytest1/nvshare:pytorch-add-idle-small-5fed3e5b"

# Optional: metrics port
export XPUSHARE_METRICS_PORT="9402"
export XPUSHARE_METRICS_LOCAL_PORT="19402"

# Optional: timeout controls
export XP_DEFAULT_POD_TIMEOUT_SEC="1800"
export XP_SOAK_DURATION_SEC="21600"
export XP_DYNAMIC_UPDATE_EXPECT_SEC="15"
export XP_DYNAMIC_UPDATE_OBSERVE_TIMEOUT_SEC="90"
export XP_TEST_POD_DELETE_TIMEOUT_SEC="240"

# Optional: cluster vGPU capacity (default assumes current deployment)
# C1: 2 nodes * 2 physical GPU/node * 10 vGPU/GPU = 40
# C2: 2 nodes * 8 physical GPU/node * 10 vGPU/GPU = 160
export XP_CLUSTER_C1_TOTAL_VGPU="40"
export XP_CLUSTER_C2_TOTAL_VGPU="160"

# Optional: metrics sampling controls
export XP_METRICS_SCRAPE_INTERVAL_SEC="2"
export XP_METRICS_STRESS_DURATION_SEC="120"

# Optional: stress payload controls
export XP_W4_MATRIX_N_C1="52000"
export XP_W4_MATRIX_N_C2="76000"
export XP_W5_DURATION_SEC="300"

# Optional: performance thresholds
export XP_PERF_METRICS_OVERHEAD_MAX_PCT="5"
export XP_PERF_MIX_RATIO_MIN="1.15"
# Global override for PERF-008 scale ladder (optional)
# export XP_PERF_SCALE_SET="2 4 8 16"
# Cluster-aware defaults
export XP_PERF_SCALE_SET_C1="2 4 8 16 24 32 40"
export XP_PERF_SCALE_SET_C2="8 16 32 64 96 128 160"

# Optional: stability/leak controls
export XP_STAB_SHORT_SEC="21600"
export XP_STAB_LONG_SEC="86400"
export XP_STAB_UPDATE_INTERVAL_SEC="300"
# Global overrides (optional)
# export XP_STAB_MIX_SMALL_PODS="16"
# export XP_STAB_MIX_LARGE_PODS="32"
# Cluster-aware defaults for STAB-002
export XP_STAB_MIX_SMALL_PODS_C1="16"
export XP_STAB_MIX_LARGE_PODS_C1="32"
export XP_STAB_MIX_SMALL_PODS_C2="64"
export XP_STAB_MIX_LARGE_PODS_C2="128"
export XP_LEAK_ROUNDS="20"
export XP_LEAK_RSS_GROWTH_MAX_KB="131072"
export XP_LEAK_FD_GROWTH_MAX="200"
export XP_LEAK_SERIES_GROWTH_MAX="200"
export XP_LEAK_GHOST_CLIENT_MAX="0"

# Optional: GPU node SSH placeholders (full ssh command prefix)
# Fill these after you decide login commands.
# Example: export XPUSHARE_C1_NODE1_SSH='ssh root@10.0.0.11 -p 22'
# Example: export XPUSHARE_C1_NODE2_SSH='ssh root@10.0.0.12 -p 22'
# Example: export XPUSHARE_C2_NODE1_SSH='ssh root@10.1.0.21 -p 32222'
# Example: export XPUSHARE_C2_NODE2_SSH='ssh root@10.1.0.22 -p 32222'

export XPUSHARE_C1_NODE1_SSH=''
export XPUSHARE_C1_NODE2_SSH=''
export XPUSHARE_C2_NODE1_SSH=''
export XPUSHARE_C2_NODE2_SSH=''

# Optional: remote scheduler log streaming (for large logs)
# Reuses XPUSHARE_C*_NODE*_SSH variables.
# If at least one node SSH is set for a cluster, each case starts remote
# `kubectl logs -f` and then fetches the file at case end.
export XPUSHARE_REMOTE_SCHED_LOG_DIR='/tmp/xpushare-scheduler-logs'

# Optional: disruptive failover cases (default disabled)
export XP_ENABLE_DISRUPTIVE='0'
export XP_FAIL_RESTART_TIMEOUT_SEC='240'
# Fill node names when running FAIL-003/FAIL-004.
export XP_C1_DRAIN_NODE=''
export XP_C2_STRESS_NODE=''

# Optional: if you want to skip some expensive suites
export XP_SKIP_STABILITY='0'

# Optional: smoke suite case list and resume mode
export XP_SMOKE_CASES='FUNC-001 FUNC-007 COMBO-003 MET-001'
export XPUSHARE_RESUME_MODE='0'
